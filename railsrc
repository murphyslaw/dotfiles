warn '~/.railsrc loaded'

require 'logger'

# load hirb
begin
  require 'hirb'
rescue LoadError => error
  warn "Couldn't load hirb: #{error}"
end

def loud_logger
  enable_hirb
  set_logger_to(Logger.new(STDOUT))
end

def quiet_logger
  disable_hirb
  set_logger_to(nil)
end

def set_logger_to(logger)
  if defined?(ActiveRecord)
    ActiveRecord::Base.logger = logger
    ActiveRecord::Base.clear_reloadable_connections!
  end
end

def enable_hirb
  if defined?(Hirb)
    Hirb::Formatter.dynamic_config['ActiveRecord::Base']
    Hirb.enable
  end
end

def disable_hirb
  if defined?(Hirb)
    Hirb.disable
  end
end

# configure irb
rails_root = File.basename(Dir.pwd)
IRB.conf[:PROMPT] ||= {}
IRB.conf[:PROMPT][:RAILS] = {
  PROMPT_I: "#{rails_root} >> ", # normal prompt
  PROMPT_S: "#{rails_root} *> ", # prompt when continuing a string
  PROMPT_C: "#{rails_root} *> ", # prompt when continuing a statement
  RETURN: "%s\n" # prefixes output
}
IRB.conf[:PROMPT_MODE] = :RAILS